[2023-06-12T02:06:47.613+0000] {taskinstance.py:1090} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: ticketmaster_GCS_to_BQ_dag.move_files_to_bigquery manual__2023-06-12T01:45:47.191323+00:00 [queued]>
[2023-06-12T02:06:47.619+0000] {taskinstance.py:1090} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: ticketmaster_GCS_to_BQ_dag.move_files_to_bigquery manual__2023-06-12T01:45:47.191323+00:00 [queued]>
[2023-06-12T02:06:47.620+0000] {taskinstance.py:1288} INFO - 
--------------------------------------------------------------------------------
[2023-06-12T02:06:47.621+0000] {taskinstance.py:1289} INFO - Starting attempt 8 of 9
[2023-06-12T02:06:47.621+0000] {taskinstance.py:1290} INFO - 
--------------------------------------------------------------------------------
[2023-06-12T02:06:47.631+0000] {taskinstance.py:1309} INFO - Executing <Task(GCSToBigQueryOperator): move_files_to_bigquery> on 2023-06-12 01:45:47.191323+00:00
[2023-06-12T02:06:47.636+0000] {standard_task_runner.py:55} INFO - Started process 812 to run task
[2023-06-12T02:06:47.640+0000] {standard_task_runner.py:82} INFO - Running: ['***', 'tasks', 'run', 'ticketmaster_GCS_to_BQ_dag', 'move_files_to_bigquery', 'manual__2023-06-12T01:45:47.191323+00:00', '--job-id', '237', '--raw', '--subdir', 'DAGS_FOLDER/gcs_to_bigquery.py', '--cfg-path', '/tmp/tmpib9nu5a9']
[2023-06-12T02:06:47.642+0000] {standard_task_runner.py:83} INFO - Job 237: Subtask move_files_to_bigquery
[2023-06-12T02:06:47.711+0000] {task_command.py:389} INFO - Running <TaskInstance: ticketmaster_GCS_to_BQ_dag.move_files_to_bigquery manual__2023-06-12T01:45:47.191323+00:00 [running]> on host 04f5a8a63034
[2023-06-12T02:06:47.765+0000] {taskinstance.py:1518} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_OWNER=nburkett
AIRFLOW_CTX_DAG_ID=ticketmaster_GCS_to_BQ_dag
AIRFLOW_CTX_TASK_ID=move_files_to_bigquery
AIRFLOW_CTX_EXECUTION_DATE=2023-06-12T01:45:47.191323+00:00
AIRFLOW_CTX_TRY_NUMBER=8
AIRFLOW_CTX_DAG_RUN_ID=manual__2023-06-12T01:45:47.191323+00:00
[2023-06-12T02:06:47.767+0000] {crypto.py:83} WARNING - empty cryptography key - values will not be stored encrypted.
[2023-06-12T02:06:47.768+0000] {base.py:73} INFO - Using connection ID 'google_cloud_default' for task execution.
[2023-06-12T02:06:47.769+0000] {gcs_to_bigquery.py:382} INFO - Using existing BigQuery table for storing data...
[2023-06-12T02:06:47.813+0000] {gcs_to_bigquery.py:386} INFO - Executing: {'load': {'autodetect': True, 'createDisposition': 'CREATE_IF_NEEDED', 'destinationTable': {'projectId': 'global-maxim-338114', 'datasetId': 'twitter_kafka_pyspark_test', 'tableId': 'ticketmaster_***_stg'}, 'sourceFormat': 'CSV', 'sourceUris': ['gs://dtc_data_lake_global-maxim-338114/*.parquet'], 'writeDisposition': 'WRITE_APPEND', 'ignoreUnknownValues': False, 'schema': {'fields': '[{"name": "event_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_type", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_url", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_zipcode", "type": "INTEGER", "mode": "NULLABLE"}, {"name": "venues_timezone", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_city", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_state_full", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_state_short", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_country_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_country_short", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_address", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_longitude", "type": "FLOAT", "mode": "NULLABLE"}, {"name": "venue_latitude", "type": "FLOAT", "mode": "NULLABLE"}, {"name": "attraction_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_type", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_url", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_segment_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_segment_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_genre_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_genre_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_subgenre_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_subgenre_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_start_date", "type": "DATE", "mode": "NULLABLE"}, {"name": "ticket_status", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_start_time", "type": "STRING", "mode": "NULLABLE"}, {"name": "currency", "type": "STRING", "mode": "NULLABLE"}, {"name": "min_price", "type": "FLOAT", "mode": "NULLABLE"}, {"name": "max_price", "type": "FLOAT", "mode": "NULLABLE"}]'}, 'skipLeadingRows': None, 'fieldDelimiter': ',', 'quote': None, 'allowQuotedNewlines': False, 'encoding': 'UTF-8'}}
[2023-06-12T02:06:47.815+0000] {bigquery.py:1546} INFO - Inserting job ***_ticketmaster_GCS_to_BQ_dag_move_files_to_bigquery_2023_06_12T01_45_47_191323_00_00_c81dcca24e0c5286f8784506a86748e9
[2023-06-12T02:06:48.206+0000] {taskinstance.py:1776} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/providers/google/cloud/transfers/gcs_to_bigquery.py", line 387, in execute
    job = self._submit_job(self.hook, job_id)
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/providers/google/cloud/transfers/gcs_to_bigquery.py", line 314, in _submit_job
    nowait=True,
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/providers/google/common/hooks/base_google.py", line 468, in inner_wrapper
    return func(self, *args, **kwargs)
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/providers/google/cloud/hooks/bigquery.py", line 1549, in insert_job
    job._begin()
  File "/home/airflow/.local/lib/python3.7/site-packages/google/cloud/bigquery/job/base.py", line 518, in _begin
    timeout=timeout,
  File "/home/airflow/.local/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 782, in _call_api
    return call()
  File "/home/airflow/.local/lib/python3.7/site-packages/google/api_core/retry.py", line 288, in retry_wrapped_func
    on_error=on_error,
  File "/home/airflow/.local/lib/python3.7/site-packages/google/api_core/retry.py", line 190, in retry_target
    return target()
  File "/home/airflow/.local/lib/python3.7/site-packages/google/cloud/_http/__init__.py", line 494, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 POST https://bigquery.googleapis.com/bigquery/v2/projects/global-maxim-338114/jobs?prettyPrint=false: Invalid value at 'job.configuration.load.schema.fields' (type.googleapis.com/google.cloud.bigquery.v2.TableFieldSchema), "[{"name": "event_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_type", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_url", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_zipcode", "type": "INTEGER", "mode": "NULLABLE"}, {"name": "venues_timezone", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_city", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_state_full", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_state_short", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_country_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_country_short", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_address", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_longitude", "type": "FLOAT", "mode": "NULLABLE"}, {"name": "venue_latitude", "type": "FLOAT", "mode": "NULLABLE"}, {"name": "attraction_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_type", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_url", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_segment_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_segment_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_genre_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_genre_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_subgenre_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_subgenre_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_start_date", "type": "DATE", "mode": "NULLABLE"}, {"name": "ticket_status", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_start_time", "type": "STRING", "mode": "NULLABLE"}, {"name": "currency", "type": "STRING", "mode": "NULLABLE"}, {"name": "min_price", "type": "FLOAT", "mode": "NULLABLE"}, {"name": "max_price", "type": "FLOAT", "mode": "NULLABLE"}]"
[2023-06-12T02:06:48.218+0000] {taskinstance.py:1332} INFO - Marking task as UP_FOR_RETRY. dag_id=ticketmaster_GCS_to_BQ_dag, task_id=move_files_to_bigquery, execution_date=20230612T014547, start_date=20230612T020647, end_date=20230612T020648
[2023-06-12T02:06:48.227+0000] {standard_task_runner.py:105} ERROR - Failed to execute job 237 for task move_files_to_bigquery (400 POST https://bigquery.googleapis.com/bigquery/v2/projects/global-maxim-338114/jobs?prettyPrint=false: Invalid value at 'job.configuration.load.schema.fields' (type.googleapis.com/google.cloud.bigquery.v2.TableFieldSchema), "[{"name": "event_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_type", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_url", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_zipcode", "type": "INTEGER", "mode": "NULLABLE"}, {"name": "venues_timezone", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_city", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_state_full", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_state_short", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_country_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_country_short", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_address", "type": "STRING", "mode": "NULLABLE"}, {"name": "venue_longitude", "type": "FLOAT", "mode": "NULLABLE"}, {"name": "venue_latitude", "type": "FLOAT", "mode": "NULLABLE"}, {"name": "attraction_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_type", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_url", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_segment_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_segment_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_genre_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_genre_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_subgenre_id", "type": "STRING", "mode": "NULLABLE"}, {"name": "attraction_subgenre_name", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_start_date", "type": "DATE", "mode": "NULLABLE"}, {"name": "ticket_status", "type": "STRING", "mode": "NULLABLE"}, {"name": "event_start_time", "type": "STRING", "mode": "NULLABLE"}, {"name": "currency", "type": "STRING", "mode": "NULLABLE"}, {"name": "min_price", "type": "FLOAT", "mode": "NULLABLE"}, {"name": "max_price", "type": "FLOAT", "mode": "NULLABLE"}]"; 812)
[2023-06-12T02:06:48.256+0000] {local_task_job.py:212} INFO - Task exited with return code 1
[2023-06-12T02:06:48.274+0000] {taskinstance.py:2596} INFO - 0 downstream tasks scheduled from follow-on schedule check
